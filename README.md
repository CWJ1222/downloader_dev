# Fastcamp Downloader

패스트캠퍼스 KDT 강의 영상을 자동으로 수집하고 다운로드하는 도구입니다.

## 빠른 시작

```bash
# 1. 의존성 설치
npm install

# 2. Playwright 브라우저 설치
npx playwright install chromium

# 3. 서버 실행
npm start

# 4. 브라우저에서 접속
open http://localhost:3000
```

## 파일 구조

```
├── server.js                 # 웹 서버 (Express + WebSocket)
├── downloader.js             # 다운로드 로직 모듈 (자동 로그인, 목록 수집, 다운로드)
├── public/
│   └── index.html            # 웹 UI 페이지
├── download-status.json      # 다운로드 진행 상태 저장 (자동 생성)
├── collect-and-download.js   # CLI 버전 (기존, 수동 로그인)
├── retry-failed.js           # 실패 재시도
└── package.json
```

## 주요 기능

- **웹 UI** - 브라우저에서 편리하게 설정 및 관리
- **자동 로그인** - 아이디/비밀번호 입력 후 자동으로 로그인 및 강의 페이지 이동
- **병렬 목록 수집** - 3개 워커가 동시에 Part를 수집하여 속도 3배 향상
- **실시간 목록 수집** - 강의 목록 수집 중 실시간으로 UI에 표시
- **저장된 목록 자동 로드** - 페이지 접속 시 이전에 수집한 목록 자동 표시
- **선택적 다운로드** - 체크박스로 원하는 항목만 선택
- **진행 상태 저장** - 완료/미완료 상태를 파일로 저장
- **이어받기** - 프로그램 재실행 시 미완료 항목부터 자동 재개
- **실시간 진행률** - 각 파일별 다운로드 % 표시
- **백그라운드 실행** - headless 브라우저로 화면에 보이지 않게 작업

## 작동 방식

```
┌─────────────────────────────────────────────────────────────────┐
│  사용자 입력 (웹 UI)                                            │
│  - 강의 URL (기본값 제공)                                       │
│  - 아이디 / 비밀번호                                            │
│  - 저장 폴더                                                    │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│  1. 자동 로그인 (headless 브라우저)                             │
│     - 로그인 페이지 접속                                        │
│     - 아이디/비밀번호 자동 입력                                  │
│     - 로그인 버튼 클릭                                          │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│  2. 강의 페이지로 직접 이동                                      │
│     - 로그인 후 /me/curriculum 으로 리다이렉트됨 (무시)          │
│     - 세션 유지된 상태로 강의 URL로 직접 이동                    │
│     - 예: /classroom/236004?organizationProductId=23601         │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│  3. 강의 목록 병렬 수집                                          │
│     ┌─────────────┬─────────────┬─────────────┐                 │
│     │  워커 1     │  워커 2     │  워커 3     │                 │
│     │  Part 1~49  │  Part 50~98 │  Part 99~147│                 │
│     └─────────────┴─────────────┴─────────────┘                 │
│     - 3개 브라우저 탭이 동시에 Part 수집 (속도 3배)              │
│     - 수집 즉시 WebSocket으로 UI에 실시간 표시                   │
│     - download-status.json에 목록 저장                          │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│  4. 선택 항목 다운로드                                           │
│     - 체크된 항목만 다운로드 큐에 추가                           │
│     - ffmpeg으로 m3u8 → mp4 변환                                │
│     - 실시간 진행률 WebSocket으로 전송                          │
│     - 완료/실패 상태 저장                                       │
└─────────────────────────────────────────────────────────────────┘
```

## 요구사항

- **Node.js** v18 이상
- **ffmpeg** (시스템에 설치 필요)
- **Playwright** (Chromium 브라우저)

## 설치

### 1. 의존성 설치

```bash
npm install
```

### 2. ffmpeg 설치

```bash
# macOS
brew install ffmpeg

# Ubuntu/Debian
sudo apt install ffmpeg

# Windows (Chocolatey)
choco install ffmpeg
```

### 3. Playwright 브라우저 설치

```bash
npx playwright install chromium
```

## 설정

`collect-and-download.js` 파일 상단에서 설정을 변경할 수 있습니다:

```javascript
// 다운로드할 강의 URL
const COURSE_URL = 'https://kdt.fastcampus.co.kr/classroom/236004?organizationProductId=23601';

// 출력 설정
const OUTPUT_FILE = './video-urls.json';  // URL 목록 저장 파일
const OUTPUT_DIR = './videos';            // 영상 저장 폴더

// 테스트 모드 (true: 일부만, false: 전체)
const TEST_MODE = false;
const TEST_LIMIT = 30;

// 동시 다운로드 수
const MAX_CONCURRENT_DOWNLOADS = 3;
```

## 사용법

### 방법 1: 웹 UI (권장)

```bash
node server.js
```

1. 브라우저에서 `http://localhost:3000` 접속
2. 이전에 수집한 목록이 있으면 자동으로 표시됨
3. 강의 URL (기본값 제공), 아이디, 비밀번호, 저장 폴더 입력
4. **목록 가져오기** 클릭 → 실시간으로 강의 목록 수집 및 표시
5. 다운로드할 항목 체크박스로 선택
6. **선택 항목 다운로드** 클릭
7. 백그라운드에서 자동 로그인 & 다운로드 진행
8. 실시간 진행 상황 확인 (파일별 % 표시)

#### 웹 UI 화면 예시

```
┌─────────────────────────────────────────────────────────────┐
│  Fastcamp Downloader                                        │
├─────────────────────────────────────────────────────────────┤
│  강의 URL:  [https://kdt.fastcampus.co.kr/classroom/...]    │
│  아이디:    [________________________]                       │
│  비밀번호:  [________________________]                       │
│  저장 폴더: [./videos_______________]                       │
│                                                             │
│        [ 목록 가져오기 ]    [ 선택 항목 다운로드 ]           │
├─────────────────────────────────────────────────────────────┤
│  [x] 전체 선택                                              │
│                                                             │
│  ▼ PART 1: 강의 소개 (3/5 완료)                             │
│    [x] ✅ Ch1-오리엔테이션.mp4                              │
│    [x] ✅ Ch2-환경설정.mp4                                  │
│    [x] ✅ Ch3-기본개념.mp4                                  │
│    [x] ⏳ Ch4-실습예제.mp4              [████████░░] 45%    │
│    [ ] ⬜ Ch5-마무리.mp4                                    │
│                                                             │
│  ▼ PART 2: 본격 시작 (0/8 완료)                             │
│    [ ] ⬜ Ch1-데이터구조.mp4                                │
│    [ ] ⬜ Ch2-알고리즘.mp4                                  │
│    ...                                                      │
├─────────────────────────────────────────────────────────────┤
│  전체: 45/120 (37%) │ 완료: 42 │ 진행중: 3 │ 대기: 75       │
└─────────────────────────────────────────────────────────────┘
```

#### 상태 아이콘

| 아이콘 | 상태 |
|--------|------|
| ⬜ | 대기 (미다운로드) |
| ⏳ | 다운로드 중 |
| ✅ | 완료 |
| ❌ | 실패 |

#### 이어받기

- 프로그램 종료 후 재실행해도 `download-status.json`에 진행 상태가 저장됨
- 페이지 접속 시 저장된 목록이 자동으로 로드되어 표시됨
- 완료된 항목은 자동으로 ✅ 표시되고 체크 해제됨
- 미완료 항목만 선택하여 이어서 다운로드 가능

### 방법 2: CLI (기존 방식)

```bash
node collect-and-download.js
```

1. 브라우저가 열리면 패스트캠퍼스에 **로그인**합니다
2. 로그인 후 강의 리스트가 있는 강의실 페이지로 이동합니다
3. 강의실 페이지에 도착하면 자동으로 클립 수집 및 다운로드가 시작됩니다

### 실패한 영상 재시도

```bash
node retry-failed.js
```

## 출력 파일

| 파일 | 설명 |
|------|------|
| `download-status.json` | 다운로드 진행 상태 (이어받기용) |
| `video-urls.json` | 수집된 모든 클립 URL 목록 |
| `failed-downloads.json` | 다운로드 실패한 클립 목록 |
| `videos/` | 다운로드된 영상 (Part별 폴더) |

### 폴더 구조

```
videos/
├── Part 1 - 강의제목/
│   ├── PART1-Ch1-클립제목.mp4
│   ├── PART1-Ch2-클립제목.mp4
│   └── ...
├── Part 2 - 강의제목/
│   └── ...
└── ...
```

## 성능

### 목록 수집 속도

| 방식 | Part 147개 기준 |
|------|-----------------|
| 순차 수집 | ~5분 |
| 병렬 수집 (3 워커) | ~1.5분 |

병렬 수집 워커 수는 `downloader.js`의 `PARALLEL_WORKERS` 값으로 조정 가능합니다.

### 수집 속도에 영향을 주는 요소

- **네트워크 지연** - FastCampus 서버 응답 시간 (가장 큰 영향)
- **UI 대기 시간** - Part/Chapter 펼침 애니메이션 대기
- **서버 rate limiting** - 동시 요청 시 서버가 느리게 응답할 수 있음

## 주의사항

- 다운로드 타임아웃: 5분 (영상당)
- 실패 시 자동 재시도: 최대 3회
- 이미 다운로드된 파일은 자동 스킵
- 강의 수강권이 있는 계정으로 로그인해야 합니다

## 문제 해결

### ffmpeg을 찾을 수 없음
```bash
which ffmpeg  # 경로 확인
```
PATH에 ffmpeg이 등록되어 있는지 확인하세요.

### Playwright 브라우저 오류
```bash
npx playwright install chromium --force
```

### 다운로드 속도가 느림
`MAX_CONCURRENT_DOWNLOADS` 값을 조정하세요 (기본값: 3).
